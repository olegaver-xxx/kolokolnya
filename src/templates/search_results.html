{% extends 'base.html' %}
{% load thumbnail %}


{% block content %}
    {% include 'sort.html' %}

    <ul class="products">
        {% for product in search %}
            <li class="product">
                <a href="{% url 'detail' pk=product.id %}">

                    <div class="img-wrap">
                        <img src="{% thumbnail product.images.first.image 300x400 %}" alt="img">
                        {#                                                                            </div>{% thumbnail product.images 200x300 %} #}
                    </div>
                    <div class="product-wrap">
                        <div class="star-rating">
                            <span style="width:60%">Rated
                            <strong class="rating">3.00</strong> out of 5</span>
                        </div>
                        <h2>{{ product.name }}</h2>
                        <span class="price">
                            <span>
                                <span>P</span>{{ product.price }}
                            </span>
                        </span>
                    </div>
                </a>

                <a rel="nofollow" href="{% url 'cart' %}"
                   style="display: {% if product.id in cart_items %} block {% else %} none {% endif %}"
                   class="button product_type_simple add_to_cart_button"
                   id="go-to-btn-{{ product.id }}">Go To Cart</a>
                <a rel="nofollow" href="#" data-product_id="{{ product.id }}"
                   id="add-btn-{{ product.id }}"
                   style="display: {% if product.id not in cart_items %} block {% else %} none {% endif %}"
                   class="button product_type_simple add_to_cart_button add-to-cart">Add to cart</a>
            </li>
        {% empty %}
            По вашему запрому ничего не нашлось(
        {% endfor %}
{#        <aside class="col-lg-5 col-xl-3 mb-0">#}
{#            <div class="widget widget_product_search">#}
{##}
{#                <h3 class="widget-title">Search</h3>#}
{##}
{#                <form role="search" class="woocommerce-product-search"#}
{#                      action="{% url 'search_results' %}">#}
{##}
{#                    <label class="screen-reader-text" for="woocommerce-product-search-field-widget">#}
{#                        Search for:#}
{#                    </label>#}
{##}
{#                    <input type="search" id="woocommerce-product-search-field-widget"#}
{#                           class="search-field"#}
{#                           placeholder="Search here..." name="q">#}
{#                    <input type="submit" value="Search">#}
{#                </form>#}
{#            </div>#}
{#        </aside>#}
        {% include 'pagination.html' %}

    </ul>



    <!-- columns 2 -->

    {% include 'pagination.html' %}


    <aside class="col-lg-5 col-xl-3 mb-0">
        <div class="widget widget_product_search">

            <h3 class="widget-title">Search</h3>

            <form role="search" class="woocommerce-product-search"
                  action="{% url 'search_results' %}">

                <label class="screen-reader-text" for="woocommerce-product-search-field-widget">
                    Search for:
                </label>

                <input type="search" id="woocommerce-product-search-field-widget" class="search-field"
                       placeholder="Search here..." name="q">
                <input type="submit" value="Search">
            </form>
        </div>
    </aside>

{% endblock %}
{% block scripts %}
    <script>

        $(document).ready(() => {
            $('.add-to-cart').each((i, element) => {
                console.log(element)
                $(element).click((e) => {
                    e.preventDefault();
                    let p_id = $(e.target).data('product_id');
                    $("#go-to-btn-" + p_id).show()
                    $("#add-btn-" + p_id).hide()
                    $.post("/add-to-cart/",
                        {
                            product_id: p_id,
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        }
                    ).then((data) => {
                        console.log(data)
                    })
                });
            });
        });
    </script>
{% endblock %}