{% extends 'base.html' %}
{% load thumbnail %}

{% block head %}
{% endblock %}

{% block page-title %}
    ЗАПИСКИ
{% endblock %}

{% block content %}
    <section class="ls s-py-80 s-py-md-120 s-py-xl-160">
        <div class="container fix-top">

            <div class="row c-gutter-60">

                <main class="offset-lg-1 col-lg-10">
                    <form method="post">
                        {% csrf_token %}
                        {{ form }}
                        <p>Стоимость: <span id="wordCount">0</span></p>
                        <p id="errorMessage" style="color: red;"></p>

                        <button class="btn btn-outline-maincolor mt-30">Отправить</button>
                    </form>
                </main>
            </div>
        </div>
    </section>
{% endblock %}

{% block scripts %}
    <script>

    function update_cost (){
            let words = this.value.replace(/[\t\n\r\.\?\!]/gm, " ").split(" ");
            let count = words.reduce((a, b) => a + (b.trim() !== ''), 0);
            let cost = {{record_info.cost}};
            let names_count = {{record_info.names_per_cost}};
            let total_cost = Math.ceil(count / names_count) * cost;
            document.querySelector("#wordCount").innerText = `${total_cost}р`;
            let errorMessage = document.querySelector("#errorMessage");
            errorMessage.innerText = "";
            for (let i = 0; i < words.length; i++) {
                if (words[i].length > {{record_info.max_word_length}}) { // get from db
                    $("#submit").prop("disabled", true)
                    errorMessage.innerText = "Ошибка: Слишком длинное слово";
                    return;
                }
            }
            $("#submit").prop("disabled", false);
        }
        document.querySelector("#{{ form.description.id_for_label }}").addEventListener("input", update_cost );

        $(document).ready(() => {
            {#update_cost()#}
         })
    </script>
{% endblock %}